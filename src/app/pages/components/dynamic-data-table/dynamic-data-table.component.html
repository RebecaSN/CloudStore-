<form *ngIf="formGroup" [formGroup]="formGroup" class="dynamic-data-table">
  <mat-toolbar color="primary" class="mat-elevation-z3" *ngIf="toolbar">
    <span *ngIf="toolbarTitle" class="toolbarTitle">{{
      toolbarTitle
      }}</span>
    <span class="spacer"></span>
    <mat-form-field class="full-width search" *ngIf="filterGlobal">
      <mat-label>{{ filterGlobalLabel  }}</mat-label>
      <input matInput formControlName="_general" [(ngModel)]="filterValue"
        placeholder="{{ filterGlobalPlaceholder }}" spellcheck="false" autocomplete="false" />
      <button *ngIf="!filterValue" matSuffix mat-icon-button aria-label="Search">
        <mat-icon>search</mat-icon>
      </button>
      <button *ngIf="filterValue" matSuffix mat-icon-button aria-label="Clear" (click)="clearFilters()">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
    <span class="spacer"></span>

    <button mat-mini-fab color="success" class="success" aria-label="Example icon button with a menu icon"
      (click)="this.modalButtonClick.emit()" *ngIf="!isDisabledButtonAdd">
      <mat-icon>add</mat-icon>
    </button>
  </mat-toolbar>

  <div class="">
    <div class="stick-container">
      <table mat-table [dataSource]="dataSource" matSort matSortDisableClear
        [ngStyle]="{ 'min-width': +tableMinWidth + 'px' }" multiTemplateDataRows>
        <!-- Table header -->
        <ng-container *ngFor="let column of columns">
          <!-- <ng-container *ngIf="!column.columnHide"> -->
          <ng-container matColumnDef="{{ column.columnDef }}">
            <th [ngClass]="{
                'header-cell-left': column.alignContent === 'left',
                'header-cell-center': column.alignContent === 'center',
                'header-cell-rigth': column.alignContent === 'rigth'
              }" mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="!column.sort">
              <!-- <div fxFlexFill> -->
              {{ column.header }}
              <!-- </div> -->
            </th>
            <td mat-cell *matCellDef="let row">
              <span *ngIf="!column.isCalculate">{{
                column.cell(row)
                }}</span>
              <span *ngIf="column.isCalculate && !column.isCurrency">
                <div style="display: flex; justify-content: space-between">
                  <span></span>
                  {{ column.cell(row) | number : "1.2-2" }}
                </div>
              </span>
              <span *ngIf="column.isCalculate && column.isCurrency">
                <div style="display: flex; justify-content: space-between">
                  <span>R$</span>
                  {{ column.cell(row) | number : "1.2-2"  }}
                </div>
              </span>
              <!-- <div *ngIf="column.isMask === false && column.maskType === null">{{ column.cell(row) }}</div>
              <div *ngIf="column.isMask === true && column.maskType !== null">{{ column.cell(row) | mask: column.maskType }}</div> -->
            </td>
            <ng-container *ngIf="footer">
              <td mat-footer-cell *matFooterCellDef [ngClass]="{
                  'footer-text': column.footerText,
                  'footer-value-left': column.alignContent === 'left',
                  'footer-value-center': column.alignContent === 'center',
                  'footer-value-right': column.alignContent === 'right'
                }">
                <div *ngIf="column.isCalculate && !column.isCurrency"
                  style="display: flex; justify-content: space-between">
                  <span></span>
                  {{ calculateTotal(column) | number : "1.2-2" }}
                </div>
                <div *ngIf="column.isCalculate && column.isCurrency"
                  style="display: flex; justify-content: space-between">
                  <span>R$</span>
                  {{ calculateTotal(column) | number : "1.2-2" }}
                </div>
                <div *ngIf="!column.isCalculate">
                  {{ column.footerText }}
                </div>
              </td>
            </ng-container>
          </ng-container>
          <!-- </ng-container> -->
        </ng-container>

        <!-- Checkbox Column *ngFor="let column of columns; let i = index"-->
        <!-- <ng-container *ngIf="isCheckBox">
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef="let i = index">
              <mat-checkbox formControlName="_checkbox_all" (change)="$event ? masterToggle() : null" [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()" (click)="this.checkBoxSelected.emit([selection])">
              </mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let row">
              <mat-checkbox (click)="$event.stopPropagation()" formControlName="_checkbox" (change)="$event ? selection.toggle(row) : null"
                [checked]="selection.isSelected(row)" (click)="this.checkBoxSelected.emit([selection])">
              </mat-checkbox>
            </td>
          </ng-container>
        </ng-container> -->

        <!-- Button to expand filter by column and menu button in action column -->
        <ng-container *ngIf="buttons.length >= 0">
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>
              <!-- <button *ngIf="filterColumns" mat-icon-button matTooltip= (click)="toggleFilters = !toggleFilters">
                <mat-icon matSuffix>search</mat-icon>
              </button> -->

              <mat-checkbox *ngIf="isCheckBox" formControlName="_checkbox_all" (change)="$event ? masterToggle() : null"
                [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()"
                (click)="this.checkBoxSelected.emit([selection])">
              </mat-checkbox>
            </th>

            <td mat-cell *matCellDef="let row; let i = index" [ngStyle]="{
                width: 'calc(35px + (24px *' + buttons.length + '))',
                'text-align': 'right'
              }">
              <div class="btn-group" *ngFor="let button of buttons">
                {{
                "color" + buttons.iconColor !== null
                ? buttons.iconColor
                : "#000"
                }}
                <button *ngIf="button.type == 'menu'" mat-icon-button [matMenuTriggerFor]="menu"
                  [matMenuTriggerData]="{ data: row }">
                  <mat-icon>more_vert</mat-icon>
                </button>

                <div *ngIf="button.type == 'btn' && button.showHidden(row)">
                  <span [matTooltip]="button.permissionMsg(row) !== null ? button.permissionMsg(row) : null" matTooltipPosition="left" matTooltipClass="custom-tooltip right">
                    <button mat-icon-button [disabled]="button.disable(row)"
                      (click)="this.buttonClick.emit([button.action, button.payload(row), dataSource.filteredData.indexOf(row)])">
                      <!-- <mat-icon>{{button.icon}}</mat-icon> -->
                      <mat-icon [ngStyle]="{
                      color:
                        +button.iconColor !== null ? button.iconColor : '#000'
                    }" fontSet="fa" fontIcon="{{ button.icon }}">
                      </mat-icon>
                    </button>
                  </span>
                </div>
              </div>

              <mat-checkbox *ngIf="isCheckBox" (click)="$event.stopPropagation()" formControlName="_checkbox"
                (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)" (click)="
                  this.checkBoxSelected.emit([selection]);
                  $event.stopPropagation()
                ">
              </mat-checkbox>
            </td>

            <ng-container *ngIf="footer">
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
          </ng-container>
        </ng-container>

        <!-- column filters field, and rows of records -->
        <ng-container *ngIf="filterColumns">
          <ng-container *ngFor="let column of columns; let i = index">
            <ng-container matColumnDef="{{ column.columnSearch }}">
              <th class="header" mat-header-cell *matHeaderCellDef>
                <div fxFlexFill class="filters-container" [class.animate]="toggleFilters">
                  <mat-form-field *ngIf="i >= 0" appearance="outline">
                    <!-- <input name="{{column.columnDef}}" matInput placeholder="{{ filterColumnsPlaceholder | translate }}"
                      [formControlName]="column.columnDef" (keyup)="filteredData.emit($event)" spellcheck="false" autocomplete="false" /> -->
                    <input name="{{ column.columnDef }}" matInput
                      placeholder="{{ filterColumnsPlaceholder | translate }}" [formControlName]="column.columnDef"
                      spellcheck="false" autocomplete="false" />
                    <!-- <mat-icon matSuffix>search</mat-icon> -->
                  </mat-form-field>
                </div>
              </th>
              <td mat-cell *matCellDef="let row">{{ column.cell(row) }}</td>
            </ng-container>
          </ng-container>
        </ng-container>

        <!-- Button to clear filters  -->
        <ng-container *ngIf="filterColumns" matColumnDef="filter">
          <th mat-header-cell *matHeaderCellDef class="filterHeaderCell">
            <div class="filters-container" [class.animate]="toggleFilters">
              <button mat-icon-button matTooltip="{{
                  'components.dynamic-data-table.filter.tooltip.iconClearFilter'
                    | translate
                }}" (click)="clearFilters()">
                <mat-icon>search_off</mat-icon>
              </button>
            </div>
          </th>
        </ng-container>

        <ng-container *ngIf="isOrderColumnNumber" matColumnDef="orderColumnNumber">
          <th mat-header-cell *matHeaderCellDef>
            {{ orderColumnNumberName | translate }}
          </th>
          <td mat-cell *matCellDef="let row; let i = index">
            {{ getRowIndexSequence(row) }}
          </td>

          <ng-container *ngIf="footer">
            <td mat-footer-cell *matFooterCellDef></td>
          </ng-container>
        </ng-container>

        <ng-container *ngIf="expandDetail" matColumnDef="expand">
          <th mat-header-cell *matHeaderCellDef aria-label="row actions">
            <div class="filters-container"></div>
          </th>
          <td mat-cell *matCellDef="let element">
            <button mat-icon-button aria-label="expand row" (click)="
                expandedElement = expandedElement === element ? null : element;
                $event.stopPropagation()
              ">
              <mat-icon *ngIf="expandedElement !== element">keyboard_arrow_down</mat-icon>
              <mat-icon *ngIf="expandedElement === element">keyboard_arrow_up</mat-icon>
            </button>
          </td>
        </ng-container>

        <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
        <ng-container matColumnDef="expandedDetail">
          <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
            <div class="element-detail" [@detailExpand]="
                element == expandedElement ? 'expanded' : 'collapsed'
              ">
              <ng-container [ngTemplateOutlet]="tableTemplate"></ng-container>
              <!-- <div class="element-description">

                    <span class="element-description-attribution"> -- Wikipedia </span>
                  </div> -->
            </div>
          </td>
        </ng-container>

        <!-- <ng-container [matColumnDef]="columns.columnDef" *ngIf="footer && columsFooter>1">
          <ng-container *ngFor="let column of columns; let i = index"   >
            <td mat-footer-cell *matFooterCellDef="let row; let i=index">{{column.cell(row)}}</td>
          </ng-container>
        </ng-container> -->

        <!-- TODO: Colocar tooltip para linhas da tabela -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <!-- matTooltip="{{ 'components.dynamic-data-table.rowDblClick' | translate}}" -->
        <tr mat-row *matRowDef="let row; columns: displayedColumns; let i = index" (click)="selection.toggle(row)"
          (dblclick)="this.rowDblClick.emit(row)" [matTooltip]="matTooltipText | translate" class="element-row"
          [matTooltipDisabled]="isMatTooltipText" [class.expanded-row]="expandedElement === row"></tr>
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>

        <ng-container *ngIf="filterColumns">
          <tr mat-header-row *matHeaderRowDef="displayedColumnsSearch; sticky: true" class="mat-header-filter"></tr>
          <!-- class="no-default-height" -->
        </ng-container>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row no-data" *matNoDataRow>
          <td class="mat-cell" [attr.colspan]="displayedColumns.length">
            <div *ngIf="filterValue">
              {{
              "components.dynamic-data-table.filter-no-record" | translate
              }}
              [ {{ filterValue }} ] ...
              <!-- Nenhum registro retornado pela consulta. Filtro: [ {{filterValue}} ] ... -->
            </div>
            <div *ngIf="!filterValue">
              {{ "components.dynamic-data-table.no-record" | translate }}
            </div>
          </td>
        </tr>

        <ng-container *ngIf="footer">
          <!-- Make footer nullable -->
          <!-- <tr mat-footer-row *matFooterRowDef="['disclaimer']" class="second-footer-row"></tr> -->
          <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
        </ng-container>
      </table>
    </div>

    <div class="loading-shade" *ngIf="isLoadingResultsFilter">
      <mat-spinner *ngIf="isLoadingResultsFilter"></mat-spinner>
    </div>
    <div class="spinnerLoading" *ngIf="isLoadingResults" style="
        box-shadow: none;
        display: flex;
        justify-content: center;
        align-items: center;
      ">
      <mat-progress-spinner color="primary" mode="indeterminate">
      </mat-progress-spinner>
    </div>

    <mat-paginator *ngIf="isPaginator" [hidden]="data['totalCount']" [length]="data.length" [pageSize]="pageSize"
      [pageIndex]="data['page'] - 1" [pageSizeOptions]="pageSizeOptions" showFirstLastButtons>
    </mat-paginator>

    <mat-paginator [hidden]="!data['totalCount']" [length]="data['totalCount']" [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions" [pageIndex]="data['page'] - 1" (page)="pageChange.emit($event)"
      (pageSize)="pageSizeChange.emit($event)" showFirstLastButtons>
    </mat-paginator>

    <mat-menu #menu="matMenu">
      <ng-template matMenuContent let-data="data">
        <div *ngFor="let button of menuButtons">
          <span [matTooltip]="button.permissionMsg(data) !== null ? button.permissionMsg(data) : null"
            matTooltipPosition="left" matTooltipClass="custom-tooltip right">
            <button mat-menu-item (click)="this.buttonClick.emit([button.action, button.payload(data)])"
              [disabled]="button.disable(data)">
              <!-- <mat-icon>{{ button.icon }}</mat-icon> -->
              <mat-icon fontSet="fa" fontIcon="{{ button.icon }}" fxLayoutAlign="start center"></mat-icon>
              {{ button.description | translate }}
            </button>
          </span>
        </div>
      </ng-template>
    </mat-menu>
  </div>
  <!-- </mat-card-content>
  </mat-card> -->
</form>


<!-- [matTooltip]="!canViewBusinessPermission ? ['tooltip.permissionDenied' | translate] : null"
      matTooltipPosition="right"
      matTooltipClass="custom-tooltip right" -->
